@using Webdiyer.WebControls.Mvc;
@using CashManage.Factory.IBLL;
@using EYB.ServiceEntity.CashEntity;
@using SystemManage.Factory.IBLL;
@using System.Data.SqlClient;
@model PagedList<EYB.ServiceEntity.CashEntity.OrderEntity>
    @using HS.SupportComponents;
    @{
        ViewBag.Title = "支付界面";
        Layout = null;
        var orderNo = Request["orderNo"];
        var userid = Request["UserID"];
        var IsOpenAutoPrint = ViewBag.IsOpenAutoPrint;//自动打印
        ICashManageBLL cashBll = HS.SupportComponents.Base.XmlRegistration.Current.GetResovleContainer().Resolve<CashManage.Factory.IBLL.ICashManageBLL>();
        ISystemManageBLL systemBLL = HS.SupportComponents.Base.XmlRegistration.Current.GetResovleContainer().Resolve<ISystemManageBLL>();
        BaseinfoManage.Factory.IBLL.IBaseinfoBLL baseinfoBLL = HS.SupportComponents.Base.XmlRegistration.Current.GetResovleContainer().Resolve<BaseinfoManage.Factory.IBLL.IBaseinfoBLL>();
        var uname = ViewBag.Username;
        var opentemcard = systemBLL.GetUserSettingsValue(ViewBag.HospitalID, "ISOpenCourseTreatment");       //是否开启疗程卡打印 1开启 2关闭
                                                                                                             //获取订单详情
                                                                                                             // var entity = cashBll.GetOrderModelAll(new OrderEntity { OrderNo = orderNo,UserID=Convert.ToInt32(userid) });
        var entity = cashBll.GetOrderModel(new OrderEntity { OrderNo = orderNo });

        var kk = "1";
        if (ViewBag.HospitalID == 616 || ViewBag.HospitalID == 2 || ViewBag.HospitalID == 1108 || ViewBag.HospitalID == 1144 || ViewBag.HospitalID == 615)
        {
            kk = ViewBag.IsPrintPrice;
        }
        //单据类型判断
        string ordertitle = "";
        switch (entity.OrderType)
        {
            case 1:
                ordertitle = "消费单";
                break;
            case 2:
                ordertitle = "充值办卡单";
                break;
            case 3:
                ordertitle = "充值办卡单";
                break;
            case 4:
                ordertitle = "还款单";
                break;
            default:
                ordertitle = "退换单";
                break;

        }
        int UID = Convert.ToInt32(userid);
        //获取订单支付方式
        var payList = cashBll.GetAllPaymentOrder(new PaymentOrderEntity { OrderNo = orderNo });
        //获取订单产品详情
        var orderList = cashBll.GetOrderinfoList(new OrderinfoEntity { OrderNo = orderNo }).OrderByDescending(i => i.CardType).ToList();
        // orderList = orderList.Where(t => t.UserID==UID).ToList();
        var newList = new List<MainCardBalanceEntity>();
        var isotherList = false;
        decimal needmoney = 0;
        decimal removemoney = 0;//需要移除的价钱总和(因为单据总价格的划扣价格要扣除)
        var result15 = Common.Manager.LoginHospitalUserManager.HasPermission(Common.Define.PermissionDefine.CashManage_Ordeclear);

        var resultsign =  Common.Manager.LoginHospitalUserManager.HasPermission("42CAA9A9-E732-4966-9832-76A735F7B939");

        needmoney = orderList.Where(i => i.CardType > 1).ToList().Sum(i => i.Price * i.Quantity);
        removemoney = orderList.Where(i => i.CardType == 1).ToList().Sum(i => i.Price * i.Quantity);
        List<OrderinfoEntity> orderinfoList = new List<OrderinfoEntity>();
        for (int i = 0; i < orderList.Count; i++)
        {
            if (orderList[i].IsChongzhi == 99)
            {
                if (orderList[i].CardBalanceID != null)
                {
                    string[] idlist = orderList[i].CardBalanceID.Split(new Char[] { ',' }, StringSplitOptions.RemoveEmptyEntries);
                    foreach (var id in idlist)
                    {
                        if (id != "0" && !String.IsNullOrEmpty(id))
                        {
                            var cardbalanc = cashBll.GetMainCardBalanceModel(new MainCardBalanceEntity { ID = Convert.ToInt32(id) });
                            OrderinfoEntity oe = new OrderinfoEntity();
                            oe.AllPrice = cardbalanc.AllPrice;
                            oe.ProdcuitName = cardbalanc.ProjectName;
                            oe.Quantity = cardbalanc.AllTiems;
                            oe.Price = cardbalanc.Price;
                            oe.OldPrice = cardbalanc.RetailPrice;
                            oe.AveragePrice = oe.AllPrice / (oe.Quantity == 0 ? 1 : oe.Quantity);
                            oe.ID = orderList[i].ID;
                            orderinfoList.Add(oe);
                        }
                    }

                }
            }
            else if (orderList[i].IsChongzhi == 5)
            {
                if (orderList[i].ProdcuitName == "")
                {
                    var list = cashBll.getProjectProductNopage(new ProjectProductEntity { ProgrammeID = orderList[i].CardID });    //获取方案对应项目产品关系
                    foreach (var info in list)
                    {
                        OrderinfoEntity oe = new OrderinfoEntity();
                        oe.AllPrice = info.AllPrice;
                        if (info.Type == 1)
                        {
                            oe.ProdcuitName = baseinfoBLL.GetPrePayCardModel(info.ProjectID).Name;
                        }
                        else if (info.Type == 2)
                        {
                            oe.ProdcuitName = baseinfoBLL.GetProjectModel(info.ProjectID).Name;
                        }
                        else if (info.Type == 3)
                        {
                            oe.ProdcuitName = baseinfoBLL.GetModel(info.ProjectID).Name;
                        }

                        oe.Quantity = info.Qualtity;
                        oe.Price = info.Price;
                        oe.OldPrice = info.AllPrice;
                        oe.ID = orderList[i].ID;
                        orderinfoList.Add(oe);
                    }

                }



            }
            else if (orderList[i].IsChongzhi == 1)
            {
                //var maincalBalance = cashBll.GetMainCardBalanceModel(new MainCardBalanceEntity { ID = orderList[i].ProdcuitID });
                // orderList[i].ProdcuitName = baseinfoBLL.GetPrePayCardModel(maincalBalance.ProjectID).Name;
            }

            //退换
            if (entity.OrderType == 5)
            {
                orderList[i].Price = orderList[i].Price;
                orderList[i].Quantity = -orderList[i].Quantity;
                orderList[i].AllPrice = -orderList[i].AllPrice;
            }



        }

        string paystr = "";
        //获取打印头

        var PrintNameEntity = systemBLL.GetUserSettingsValue(ViewBag.HospitalID, "PrintName");
        if (ViewBag.HospitalID == 1108)
        {
            PrintNameEntity.AttributeValue = "蔓菲";
        }
        var PrintXuanNameEntity = systemBLL.GetUserSettingsValue(ViewBag.HospitalID, "PrintXuanName");

        //获取参与员工
        int row = 0;
        int pagecount = 0;
        var joinList = cashBll.GetAllJoinUser(new JoinUserEntity { OrderNo = orderNo }, out row, out pagecount);
        string username = "";
        var newlist = joinList.Select(i => i.UserName).Distinct().ToList();
        foreach (var info in newlist)
        {
            username += info + ",";
        }
        if (!String.IsNullOrEmpty(username))
        {
            username = username.Substring(0, username.Length - 1);
        }
        var time = entity.CreateTime.ToString("yyyy-MM-dd");
        var OrderNofilter = entity.OrderNo;
        var Autographstr = "";
        if (OrderNofilter != "")
        {
            try
            {
                //string conStr = "server=47.99.170.3;user=gaole;pwd=heyi2020!@#$%^;database=Ymsoft112";//连接字符串
                //SqlConnection conText = new SqlConnection(conStr);//创建Connection对象
                //conText.Open();//打开数据库
                //string sqls = @"SELECT top 1 Autograph, * from EYB_tb_Order WHERE OrderNo = '" + OrderNo + "'";
                //SqlCommand comText = new SqlCommand(sqls, conText);//创建Command对象
                //SqlDataReader dr;//创建DataReader对象
                //dr = comText.ExecuteReader();//执行查询
                //while (dr.Read())//判断数据表中是否含有数据
                //{
                //    var date = dr;
                //    ViewBag.Autograph = date["Autograph"].ToString();
                //}
                //dr.Close();//关闭DataReader对象
            }
            catch
            {

            }
        }
        //打印机设置
        var PrintTemplate = systemBLL.GetUserSettingsValue(ViewBag.HospitalID, "PrintTemplate").AttributeValue;

        var _HospitalID = ViewBag.HospitalID;
    }
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title></title>
        <link href="@Url.Content("~/Content/themes/default/style.css")?v=1.2" rel="stylesheet" type="text/css" media="screen" />
        <link href="@Url.Content("~/Content/themes/css/core.css")?v=1.1" rel="stylesheet" type="text/css" media="screen" />
        <link href="../../Content/themes/css/template.css" rel="stylesheet" type="text/css" />
        <script src="../../Scripts/Jquery/jquery-1.8.2.min.js" type="text/javascript"></script>
        <script src="../../Scripts/Jquery/plugins/artDialog/artDialog.js" type="text/javascript"></script>
        <script src="../../Scripts/Jquery/plugins/artDialog/plugins/iframeTools.js" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/Common/common.js")" type="text/javascript"></script>
        <!--Panel-->
        <script src="@Url.Content("~/Scripts/Common/dwz.panel.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/Common/dwz.effects.js")" type="text/javascript"></script>
        <script src="../../Scripts/Print/LodopFuncs.js" type="text/javascript"></script>


    </head>

    <body style="background: #fff;">
        <div style="width: 100%;" class="clearfix ">
            <div style="width: 48%; overflow: hidden; float: left; margin: 0px; margin-left: 10px;">
                <fieldset style="border-color: #ccc;">
                    <legend style="color: Green; font-size: 16px;">&nbsp;&nbsp;订单详情&nbsp;&nbsp;</legend>
                    <div class="mainContentRight_bottom" style="position: relative; margin-top: 0px;">
                        <table class="mainContentRight_bottomnewdepart" id="mainContentRight_bottomnewdepart">
                            <tr>
                                <td>
                                    订单类型：
                                </td>
                                <td style="color: Blue; font-size: 20px;">
                                    @EYB.Web.Code.PageFunction.GetorderType(entity.OrderType)
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 80px;">
                                    订单编号：
                                </td>
                                <td>
                                    @entity.OrderNo
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 80px;">
                                    流水号：
                                </td>
                                <td>
                                    @entity.DocumentNumber
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    订单时间：
                                </td>
                                <td>
                                    @entity.CreateTime
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    订单总额：
                                </td>
                                <td>
                                    @entity.Price
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    欠款：
                                </td>
                                <td>
                                    <label style="color: Red;">
                                        @entity.QianPrice
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    客户名称：
                                </td>
                                <td>

                                    <a id="labUserName" style="color: Blue;" href="#" onclick="OpenPatientDetail(@entity.UserID,1)">@entity.UserName</a>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    备注：
                                </td>
                                <td>
                                    @entity.Name
                                </td>
                            </tr>
                        </table>
                    </div>
                </fieldset>
            </div>
            <div style="width: 48%; overflow: hidden; float: left; margin: 0px; margin-left: 10px;">
                <fieldset style="border-color: #ccc;">
                    <legend style="color: Green; font-size: 16px;">&nbsp;&nbsp;支付方式&nbsp;&nbsp;</legend>
                    <div class="mainContentRight_bottom" style="position: relative; margin-top: 0px;"
                         id="">
                        <table class="gridTable" style="height: auto; border-collapse: collapse;" cellpadding="0"
                               cellspacing="0">
                            <thead>
                                <tr>
                                    <th>
                                        支付方式
                                    </th>
                                    <th>
                                        支付金额 /次数
                                    </th>
                                    <th>
                                        剩余金额/次数
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var info in payList)
                                {
                                    if (info.PaymentName == "疗程卡划扣")
                                    {
                                        if (opentemcard.AttributeValue == "1")
                                        {
                                            paystr += info.PaymentName + " : " + info.PayMoney + " 元  |";
                                        }
                                    }
                                    else
                                    {
                                        paystr += info.PaymentName + " : " + info.PayMoney + " 元  |";
                                    }
                                    <tr>
                                        <td>
                                            @info.PayName
                                        </td>
                                        <td>
                                            @(info.PayType == 4 ? info.PayTime.ToString() + "次" : info.PayMoney.ToString() + "元")
                                        </td>
                                        <td>
                                            @(info.PayType == 4 ? info.BalanceTiems.ToString() + "次" : info.BalanceMoney.ToString() + "元")
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div id="form2" style="display: none;">
                        <table class="gridTable" style="height: auto; border-collapse: collapse; font-size: 14px;"
                               cellpadding="0" cellspacing="0">
                            <tbody>
                                @foreach (var info in payList)
                                {
                                    if (info.PayType != 4)
                                    {
                                        <tr style="line-height: 16px; height: 16px;">
                                            <td style="line-height: 16px; height: 16px; width: 60px;">
                                                @info.PayName
                                            </td>
                                            <td style="line-height: 16px; height: 16px;">
                                                @(Convert.ToDouble(info.PayMoney).ToString("0.00") + "元")
                                            </td>
                                            <td style="line-height: 16px; height: 16px;">
                                                @(info.BalanceMoney <= 0 ? "" : "(余" + info.BalanceMoney.ToString() + "元)")
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </fieldset>
                <br />
                <div style="text-align: center">
                    @if (resultsign)
                    {
                        <input type="button" class="submitbutton4" id="btnprintsign" onclick="Previewsign(@OrderNofilter)" style="float: none; width: 100%;"
                               value="查看签名" />
                    }
                </div>
            </div>
        </div>
        <div style="width: 98%;">
            <fieldset style="width: 100%;">
                <legend style="color: Green; font-size: 16px;">&nbsp;&nbsp;订单产品详情&nbsp;&nbsp;</legend>
                <table class="gridTable" style="height: auto; border-collapse: collapse; margin-left: 5px;"
                       cellpadding="0" cellspacing="0">
                    <thead>
                        <tr>
                            <th>
                                名称
                            </th>
                            <th>
                                原价
                            </th>
                            <th>
                                优惠价格
                            </th>
                            <th>
                                数量
                            </th>
                            <th>
                                合计
                            </th>
                        </tr>
                    </thead>
                    <tbody id="gridtdbody">
                        @if (orderinfoList.Count > 0)
                        {
                            foreach (var info in orderinfoList)
                            {
                                <tr Quantity="@info.Quantity" orderinfoid="@info.ID" code="@(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName)">
                                    <td>
                                        @(info.InfoBuyType == 8 ? Html.Raw(string.Format("<a href='javascript:OpenOrderDetail(\"{0}\");'>" + (String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName) + "</a>", info.ProdcuitName)) : Html.Raw(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName))
                                    </td>
                                    <td>
                                        @info.OldPrice
                                    </td>
                                    <td>
                                        @(Convert.ToDouble(info.AveragePrice).ToString("0.00"))
                                    </td>
                                    <td>
                                        @info.Quantity
                                    </td>
                                    <td>
                                        @(Convert.ToDouble(info.AllPrice).ToString("0.00"))
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            foreach (var info in orderList)
                            {
                                <tr Quantity="@info.Quantity" orderinfoid="@info.ID" code="@(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName)">
                                    <td>
                                        @(info.InfoBuyType == 8 ? Html.Raw(string.Format("<a href='javascript:OpenOrderDetail(\"{0}\");'>" + (String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName) + "</a>", info.ProdcuitName)) : Html.Raw(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName))
                                    </td>
                                    <td>
                                        @info.Price
                                    </td>
                                    <td>
                                        @(Convert.ToDouble(info.AveragePrice).ToString("0.00"))
                                    </td>
                                    <td>
                                        @info.Quantity
                                    </td>
                                    <td>
                                        @(Convert.ToDouble(info.AllPrice).ToString("0.00"))
                                    </td>
                                </tr>
                            }
                        }
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>
                                消费总额：
                                @(Convert.ToDouble(entity.Price).ToString("0.00"))
                            </td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
            <div style="display: none;" id="form1">
                <table class="gridTable" style="height: auto; width: 100%; border-collapse: collapse;
                font-size: 14px;" cellpadding="0" cellspacing="0">
                    <tr style="height: 16px;">
                        <td style="width: 30%; line-height: 16px; height: 16px;">
                            名称
                        </td>
                        <td style="width: 40%; line-height: 16px; height: 16px;">
                            数量
                        </td>
                        <td style="width: 30%; line-height: 16px; height: 16px;">
                            金额
                        </td>
                    </tr>
                    <tbody>
                        @foreach (var info in orderList)
                        {
                            if (info.InfoBuyType == 6)
                            {
                                <tr style="height: 16px;">
                                    <td style="width: 100%; font-family: 宋体;" colspan="3">
                                        @(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName)
                                    </td>
                                </tr>
                                if (info.CardBalanceID + "" != "")
                                {
                                    var balancelist = info.CardBalanceID.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries);
                                    foreach (var binfo in balancelist)
                                    {
                                        var balanccemodel = cashBll.GetMainCardBalanceModel(new MainCardBalanceEntity { ID = HS.SupportComponents.ConvertValueHelper.ConvertIntValue(binfo) });
                                        <tr style="height: 16px;">
                                            <td style="width: 100%;" colspan="3">
                                                @balanccemodel.ProdcuitName
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>↑</td>
                                            <td>
                                                @balanccemodel.AllTiems
                                            </td>
                                            <td>
                                                @balanccemodel.AllPrice
                                            </td>
                                        </tr>
                                    }
                                }
                            }
                            else
                            {

                                if (info.CardType == 1)
                                {

                                    <tr style="height: 16px;">
                                        <td style="width: 100%;" colspan="3">
                                            @(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>划卡</td>
                                        <td colspan="2">
                                            @(info.Quantity + "次/余" + info.InstantInventory + "次")
                                        </td>
                                    </tr>

                                }
                                else
                                {
                                    var type = "";
                                    switch (info.Type)
                                    {
                                        case 1:
                                            type = "项目";
                                            break;
                                        case 2:
                                            type = "产品";
                                            break;
                                        case 3:
                                            type = "卡类";
                                            break;
                                    }
                                    <tr style="height: 16px;">
                                        <td style="width: 100%;" colspan="3">
                                            @(String.IsNullOrEmpty(info.ProdcuitName) ? info.ProdcuitName1 : info.ProdcuitName)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>@type</td>
                                        <td>
                                            @info.Quantity.ToString()
                                        </td>
                                        <td>
                                            @info.AllPrice.ToString()
                                        </td>
                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <!--Tab内容-->
        <div class="content-tab-wrap">
            <div id="floatHead" class="content-tab" style="width: 98%;">
                <div class="content-tab-ul-wrap">
                    <ul>
                        <li>
                            <a href="javascript:;" onclick="tabsChange(this);" class="selected" style="margin-left: 0px;background-color:#ea767d;">
                                参与销售或服务与 【&nbsp;&nbsp;<label id="labname"></label>&nbsp;&nbsp;】的员工列表
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-content clearfix" style="width: 98%;border:1px solid #d6d6d6;">
            <table class="gridTable" style="height: auto; border-collapse: collapse; margin-left: 5px;"
                   cellpadding="0" cellspacing="0">
                <thead>
                    <tr>
                        <th>
                            员工姓名
                        </th>
                        <th>
                            职位类别
                        </th>
                        <th style="display:none;">
                            是否指定
                        </th>
                        <th>
                            项目名称
                        </th>
                    </tr>
                </thead>
                <tbody id="gridtdbody1"></tbody>
            </table>
        </div>
        <div>
            <input type="button" class="submitbutton2" id="btnprint" onclick="Preview1()" style="float: none;"
                   value="打 印" />
            @if (entity.OrderType == 1 && entity.Statu == 1 && result15 == true)
            {
                <input type="button" class="submitbutton2" onclick="ClearOrder('@entity.OrderNo')" style="float: none;"
                       value="取消订单" />
            }
            @if (entity.Statu == 4 && result15 == true)
            {
                <input type="button" class="submitbutton2" onclick="UpdateOrder('@entity.OrderNo',1)" style="float: none;"
                       value="处理异常单据" />
            }

            @if (entity.OrderType == 4 && entity.Statu == 1 && result15 == true)
            {
                <input type="button" class="submitbutton2" onclick="UpdateOrder('@entity.OrderNo',3)" style="float: none;"
                       value="作废单据" />
            }
            @if (entity.OrderType != 1 && entity.Statu == 1 && result15 == true)
            {
                <input type="button" class="submitbutton2" onclick="UpdateOrder('@entity.OrderNo',3)" style="float: none;"
                       value="作废单据" />
            }
        </div>
        @*益湘潭的打印模板*@
        <div id="HidTab20" style="display:none;">
            <div style="width:610px;margin:20px auto  ">
                <div style="margin-bottom:10px; text-align:center;font-size:18px;"> @(PrintNameEntity.AttributeValue)出库单</div>
                <div style="display:flex;justify-content:flex-start;margin-bottom:8px;">
                    @if (ViewBag.HospitalID == 616)
                    {
                        <div style="width:50%;line-height:26px;">订单编号:@entity.OrderNo</div>
                    }
                    else
                    {

                        <div style="width:50%;line-height:26px;">订单编号:@entity.DocumentNumber</div>
                    }
                    <div style="width:50%;line-height:26px;">订单时间:@entity.CreateTime</div>
                </div>
                <div style="display:flex;justify-content:flex-start;margin-bottom:8px;">
                    <div style="width:50%;line-height:26px;">顾客名称:@entity.UserName</div>
                    <div style="width:50%;line-height:26px;">编号:@entity.MemberNo</div>
                </div>
                <div style="margin-bottom:10px;">
                    <div style="border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;border-top:1px solid #d6d6d6;">
                        <div style="display:flex;justify-content:flex-start;border-bottom:1px solid #d6d6d6;">
                            <div style="width:40%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">产品名称</div>
                            <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">品牌</div>
                            <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">数量</div>

                            @if ((ViewBag.HospitalID == 616 || ViewBag.HospitalID == 2 || ViewBag.HospitalID == 1108 || ViewBag.HospitalID == 1144 || ViewBag.HospitalID == 615) && kk == "1")
                            {
                                <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">价格</div>
                            }
                            <div style="width:20%;text-align:center;line-height:25px;">单位</div>
                        </div>


                        @{
                            var orderNoCopy = "";
                            if (orderNo != orderNoCopy && orderNo != null)
                            {
                                var PrintList = cashBll.GetOrderinfoList(new OrderinfoEntity { OrderNo = orderNo }).OrderByDescending(i => i.CardType).ToList();

                                foreach (var item in PrintList)
                                {
                                    <div style="display:flex;justify-content:flex-start;border-bottom:1px solid #d6d6d6;">
                                        <div style="width:40%; border-right:1px solid #d6d6d6;text-align:center; line-height:25px;">@item.ProdcuitName</div>
                                        <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">@item.BrandName</div>
                                        <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">@item.Quantity</div>
                                        @if ((ViewBag.HospitalID == 616 || ViewBag.HospitalID == 2 || ViewBag.HospitalID == 1108 || ViewBag.HospitalID == 1144 || ViewBag.HospitalID == 615) && kk == "1")
                                        {
                                            <div style="width:20%; border-right:1px solid #d6d6d6;text-align:center;line-height:25px;">@item.Price</div>
                                        }
                                        <div style="width:20%;text-align:center;line-height:25px;">@item.ids</div>
                                    </div>

                                }
                                orderNoCopy = orderNo;

                            }


                        }


                    </div>

                    <div style="line-height:26px;margin-bottom:10px;">备注 : @entity.Name  </div>
                    <div style="margin-bottom:10px;">
                        <div>
                            <div>需知:</div>
                            <div style="font-size:10px;line-height:18px;">1.订货后3天内（快递）或5天内（物流）如未收到货品请及时与我司联系。货到时请务必验收，如有问题请及时反馈，逾时自行承担。</div>
                            <div style="font-size:10px;line-height:18px;">2.退换货标准：出货3个月内且不影响二次销售。</div>
                            <div style="font-size:10px;line-height:18px;">3.退换货流程：和负责美导老师确认后方可退货。</div>
                        </div>

                        <div style="display:flex;justify-content:flex-start;margin-bottom:15px;">
                            <div style="width:33%;line-height:26px;">经办: </div>
                            <div style="width:33%;line-height:26px;">审核:</div>
                            <div style="width:33%;line-height:26px;">验收:</div>
                        </div>

                    </div>



                </div>
            </div>
        </div>
        @*益湘潭的打印模板*@



        <object id="LODOP_OB" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width="0"
                height="0">
            <embed id="LODOP_EM" type="application/x-print-lodop" width="0" height="0" />
        </object>
        <div style='font-size:16px; text-align:center;display:none;' id="hiddenhospitalname">@PrintNameEntity.AttributeValue</div>
        <div style='font-size:10px; text-align:center;display:none;' id="hiddentitle">@ordertitle</div>
    </body>
</html>
<script>
    var yixiangtangID = "@_HospitalID";
</script>

<script type="text/javascript">
    var time="@time";
    var pays = "@paystr";
    var uname="@uname";
    var strlist = new Array(); //定义一数组
    strlist = pays.split("|"); //字符分割
    var arr=[];
    var username="@username";
    var unlen=username.length;
    var le=unlen/16;
    var iinfo=0;
    while(iinfo<le)
    {
        var strs=username.substr(0,16);
        username=username.substr(16);
        arr.push(strs);
        iinfo=iinfo+1;
    }


    //打印
    var LODOP; //声明为全局变量
    function Preview1() {

        LODOP = getLodop(document.getElementById('LODOP_OB'), document.getElementById('LODOP_EM'));
        if ("@PrintTemplate" == "80") {
            Preview80();
        } else if ("@PrintTemplate" == "76") {
            Preview76();

        } else {
            Preview58();

        }

    };
    //打开顾客详情1
    function OpenPatientDetail(obj, type) {
        art.dialog.open("/PatientManage/PatientDetailControl?type=" + type + "&UserID=" + obj, { title: "@entity.UserName 顾客详情", width: 960, height: 640 });
    }
    function Previewsign(type) {
        art.dialog.open("/CashManage/SignView?OrderNofilter=@entity.OrderNo" + "&UserID1"+ @entity.OrderNo + "&UserID= 1", { title: "@entity.UserName 签名详情 - @entity.OrderNo" , width: 500, height: 280 });
    }
    function Preview58() {
        try {

            LODOP.PRINT_INIT("自定义纸张");
            //         document.getElementById('W1').value;
            //这个方法只能设置固定宽度，无法设定自适应宽度
            //LODOP.SET_PRINT_PAGESIZE(3, 580, 45, "A4");
            if (yixiangtangID == 616 ||yixiangtangID == 2 || yixiangtangID == 1108 || yixiangtangID == 1144 || yixiangtangID == 615) {
                LODOP.SET_PRINT_PAGESIZE(1, 0, 0, "A4");
            } else {
                LODOP.SET_PRINT_PAGESIZE(3, 580, 45, "A4");
            }

            LODOP.SET_PRINTER_INDEXA(-1); //指定打印机
            LODOP.SET_PRINT_MODE("RESELECT_PAGESIZE", true);

            AddPrintContent58();

            if ("@IsOpenAutoPrint" == "1") {
                (yixiangtangID == 616 ||yixiangtangID == 2 || yixiangtangID == 1108  || yixiangtangID == 1144 || yixiangtangID == 615) ? LODOP.PREVIEW() : LODOP.PRINT();
                } else {

                (yixiangtangID == 616 ||yixiangtangID == 2 || yixiangtangID == 1108 || yixiangtangID == 1144 || yixiangtangID == 615) ? LODOP.PRINT() : LODOP.PREVIEW();

            }

            @*if ("@IsOpenAutoPrint" == "1") {
                LODOP.PRINT();
            } else {
                LODOP.PREVIEW();
            }*@
            //closeed();
        } catch (e) {
            alert("请安装打印控件!" + e);
        }
    }

    function Preview76() {
        try {
            LODOP.PRINT_INIT("自定义纸张");
            //         document.getElementById('W1').value;
            //这个方法只能设置固定宽度，无法设定自适应宽度
            LODOP.SET_PRINT_PAGESIZE(3, 760, 45, "A4");
            LODOP.SET_PRINTER_INDEXA(-1); //指定打印机
            LODOP.SET_PRINT_MODE("RESELECT_PAGESIZE", true);

            AddPrintContent76();
            if ("@IsOpenAutoPrint" == "1") {
                LODOP.PRINT();
            } else {
                LODOP.PREVIEW();
            }
            //closeed();
        } catch (e) {
            alert("请安装打印控件!");
        }
    }
    function Preview80() {

        try {
            LODOP.PRINT_INIT("自定义纸张");
            //         document.getElementById('W1').value;
            //这个方法只能设置固定宽度，无法设定自适应宽度
            LODOP.SET_PRINT_PAGESIZE(3, 800, 45, "A4");
            LODOP.SET_PRINTER_INDEXA(-1); //指定打印机
            LODOP.SET_PRINT_MODE("RESELECT_PAGESIZE", true);

            AddPrintContent80();
            if ("@IsOpenAutoPrint" == "1") {
                LODOP.PRINT();
            } else {
                LODOP.PREVIEW();
            }
            //closeed();
        } catch (e) {
            alert("请安装打印控件!");
        }
    }
    function AddPrintContent58() {

        if (yixiangtangID == 616 ||yixiangtangID == 2 || yixiangtangID == 1108 || yixiangtangID == 1144 || yixiangtangID == 615) {
            LODOP.ADD_PRINT_HTM(30, "5%", "90%", "90%", document.getElementById("HidTab20").innerHTML);
            LODOP.NewPageA();
        } else {
            // LODOP.SET_PRINT_STYLE("FontColor", 16711680);
        // LODOP.ADD_PRINT_RECT(62, 16, 459, 217, 0, 1);
        //LODOP.SET_PRINT_STYLEA(2, "FontSize", 16);
        LODOP.ADD_PRINT_HTM(15, 20, "100%", 25, document.getElementById("hiddenhospitalname").innerHTML+document.getElementById("hiddentitle").innerHTML);
        LODOP.SET_PRINT_STYLE("FontSize",10);
        LODOP.SET_PRINT_STYLE("FontName", "宋体");
        LODOP.SET_PRINT_STYLE("FontColor", 0);
        // LODOP.ADD_PRINT_TEXT(36, 75, 100, 20, "消费单");
        // LODOP.ADD_PRINT_HTM(30, 30, "100%", 20, document.getElementById("hiddentitle").innerHTML);
        LODOP.ADD_PRINT_TEXT(50, 5, "100%", 20, "流水: @entity.DocumentNumber");
        @*LODOP.ADD_PRINT_TEXT(65, 5, "100%", 20, "卡号: @entity.MemberNo 姓名: @entity.UserName");*@
        LODOP.ADD_PRINT_TEXT(65, 5, "100%", 20, "卡号: @entity.MemberNo");
        LODOP.ADD_PRINT_TEXT(80, 5, "100%", 20, "姓名: @entity.UserName");
        LODOP.ADD_PRINT_TEXT(95, 5, "100%", 20, "分店: @entity.HospitalName");
        //    LODOP.ADD_PRINT_LINE(96, 0, 90, 500, 2, 1)//横线
        //订单详情
        var form1height = $("#form1").height();
        LODOP.ADD_PRINT_HTM(110, 5, "100%", form1height,document.getElementById("form1").innerHTML );
        //var trheight = 0;
        //$("#form1 tr").each(function(i) {
        //    trheight += $(this).height();
        //    if ($(this).text().length > 13) {
        //        trheight += $(this).height();
        //    }
        //});
        var nowheight = form1height+120 ;
        // var nowheight = trheight ;
        LODOP.ADD_PRINT_TEXT(nowheight, 5, "100%", 20, "合计       @needmoney 元");
        LODOP.ADD_PRINT_TEXT(nowheight +15, 5, "100%", 20, "折让       @(needmoney - (entity.Price - removemoney))元");
        LODOP.ADD_PRINT_TEXT(nowheight+30, 5, "100%", 20, "应付       @(entity.Price - removemoney) 元");
        //LODOP.ADD_PRINT_LINE(nowheight+45, 0, nowheight+35, 500, 2, 1)//横线
        //支付方式
        //        for (var i = 0; i < strlist.length; i++) {
        //            LODOP.ADD_PRINT_TEXT(nowheight + (16 * i)+45, 5, 580, 20, strlist[i].toString());
        //        }
        //如果存在欠款
        if(@entity.QianPrice!="0")
        {
            LODOP.ADD_PRINT_TEXT(nowheight + 45, 5, "100%", 20, "欠款       @entity.QianPrice 元");
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight +  60, 5, "100%", form2height, document.getElementById("form2").innerHTML);
            //var trheight1 = 0;
            //$("#form2 tr").each(function (i) {
            //    trheight1 += $(this).height();
            //})
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+75, 5, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+90, 5, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+90+(15*i), 5, "100%", 20,arr[i]);
                }
            }
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+105+(arr.length*15), 5, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+135+(arr.length*15), 5, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+165+(arr.length*15), 5, "100%", 20, "签名：");
        }else{
            //不存在欠款
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight + 45, 5, "100%", form2height, document.getElementById("form2").innerHTML);
            //var trheight1 = 0;
            //$("#form2 tr").each(function (i) {
            //    trheight1 += $(this).height();
            //})
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+60, 5, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+75, 5, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+75+(15*i), 5, "100%", 20,arr[i]);
                }
            }
            //  LODOP.ADD_PRINT_LINE(nowheight + trheight1+75+32+(arr.length*20), 0, nowheight + trheight1+75+32+(arr.length*20), 500, 2, 1)//横线
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+90+(arr.length*15), 5, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+120+(arr.length*15), 5, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+150+(arr.length*15), 5, "100%", 20, "签名：");
        }


        }


    };
    function AddPrintContent76() {
        // LODOP.SET_PRINT_STYLE("FontColor", 16711680);
        // LODOP.ADD_PRINT_RECT(62, 16, 459, 217, 0, 1);
        //LODOP.SET_PRINT_STYLEA(2, "FontSize", 16);
        LODOP.ADD_PRINT_HTM(15, 20, "100%", 25,  document.getElementById("hiddenhospitalname").innerHTML+document.getElementById("hiddentitle").innerHTML);
        LODOP.SET_PRINT_STYLE("FontSize",12);
        LODOP.SET_PRINT_STYLE("FontName", "宋体");
        LODOP.SET_PRINT_STYLE("FontColor", 0);
        // LODOP.ADD_PRINT_TEXT(36, 75, 100, 20, "消费单");
        // LODOP.ADD_PRINT_HTM(30, 30, "100%", 20, document.getElementById("hiddentitle").innerHTML);
        LODOP.ADD_PRINT_TEXT(65, 5, "100%", 20, "流水: @entity.DocumentNumber");
        @*LODOP.ADD_PRINT_TEXT(65, 5, "100%", 20, "卡号: @entity.MemberNo 姓名: @entity.UserName");*@
        LODOP.ADD_PRINT_TEXT(85, 5, "100%", 20, "卡号: @entity.MemberNo");
        LODOP.ADD_PRINT_TEXT(105, 5, "100%", 20, "姓名: @entity.UserName");
        LODOP.ADD_PRINT_TEXT(125, 5, "100%", 20, "分店: @entity.HospitalName");
        //    LODOP.ADD_PRINT_LINE(96, 0, 90, 500, 2, 1)//横线
        //订单详情
        var form1height = $("#form1").height();
        LODOP.ADD_PRINT_HTM(145, 5, "100%", form1height,document.getElementById("form1").innerHTML );
        //var trheight = 0;
        //$("#form1 tr").each(function(i) {
        //    trheight += $(this).height();
        //    if ($(this).text().length > 13) {
        //        trheight += $(this).height();
        //    }
        //});
        var nowheight = form1height+155 ;
        // var nowheight = trheight ;
        LODOP.ADD_PRINT_TEXT(nowheight, 5, "100%", 20, "合计       @needmoney 元");
        LODOP.ADD_PRINT_TEXT(nowheight +20, 5, "100%", 20, "折让       @(needmoney - (entity.Price - removemoney))元");
        LODOP.ADD_PRINT_TEXT(nowheight+40, 5, "100%", 20, "应付       @(entity.Price - removemoney) 元");
        //LODOP.ADD_PRINT_LINE(nowheight+45, 0, nowheight+35, 500, 2, 1)//横线
        //支付方式
        //        for (var i = 0; i < strlist.length; i++) {
        //            LODOP.ADD_PRINT_TEXT(nowheight + (16 * i)+45, 5, 580, 20, strlist[i].toString());
        //        }
        //如果存在欠款
        if(@entity.QianPrice!="0")
        {
            LODOP.ADD_PRINT_TEXT(nowheight  +60, 5, "100%", 20, "欠款       @entity.QianPrice 元");
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight +  80, 5, "100%", form2height, document.getElementById("form2").innerHTML);
            //var trheight1 = 0;
            //$("#form2 tr").each(function(i) {
            //    trheight1 += $(this).height();
            //});
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+100, 5, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+120, 5, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+120+(20*i), 5, "100%", 20,arr[i]);
                }
            }
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+120+(arr.length*20), 5, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+140+(arr.length*20), 5, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+180+(arr.length*20), 5, "100%", 20, "签名：");
        }else{
            //不存在欠款
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight + 60, 5, "100%", form2height, document.getElementById("form2").innerHTML);
            //var trheight1 = 0;
            //$("#form2 tr").each(function(i) {
            //    trheight1 += $(this).height();
            //});
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+80, 5, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+100, 5, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+100+(20*i), 5, "100%", 20,arr[i]);
                }
            }
            //  LODOP.ADD_PRINT_LINE(nowheight + trheight1+75+32+(arr.length*20), 0, nowheight + trheight1+75+32+(arr.length*20), 500, 2, 1)//横线
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+120+(arr.length*20), 5, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+140+(arr.length*20), 5, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+180+(arr.length*20), 5, "100%", 20, "签名：");
        }
    };
    function AddPrintContent80() {
        // LODOP.SET_PRINT_STYLE("FontColor", 16711680);
        // LODOP.ADD_PRINT_RECT(62, 16, 459, 217, 0, 1);
        //LODOP.SET_PRINT_STYLEA(2, "FontSize", 16);
        LODOP.ADD_PRINT_HTM(15, 60, "100%", 25, document.getElementById("hiddenhospitalname").innerHTML+document.getElementById("hiddentitle").innerHTML);
        LODOP.SET_PRINT_STYLE("FontSize",10);
        LODOP.SET_PRINT_STYLE("FontName", "宋体");
        LODOP.SET_PRINT_STYLE("FontColor", 0);
        // LODOP.ADD_PRINT_TEXT(36, 75, 100, 20, "消费单");
        // LODOP.ADD_PRINT_HTM(36, 60, "100%", 85, );
        LODOP.ADD_PRINT_TEXT(65, 60, "100%", 20, "流水: @entity.DocumentNumber");
        LODOP.ADD_PRINT_TEXT(85, 60, "100%", 20, "卡号: @entity.MemberNo 姓名: @entity.UserName");
        LODOP.ADD_PRINT_TEXT(105, 60, "100%", 20, "分店: @entity.HospitalName");
        //    LODOP.ADD_PRINT_LINE(96, 0, 90, 500, 2, 1)//横线
        //订单详情
        var form1height = $("#form1").height();
        LODOP.ADD_PRINT_HTM(125, 60, "100%", form1height,document.getElementById("form1").innerHTML );
        //var trheight = 0;
        //$("#form1 tr").each(function(i) {
        //    trheight += $(this).height();
        //    if ($(this).text().length > 13) {
        //        trheight += $(this).height();
        //    }
        //});
        var nowheight = form1height+135 ;
        // var nowheight = trheight ;
        LODOP.ADD_PRINT_TEXT(nowheight, 60, "100%", 20, "合计       @needmoney 元");
        LODOP.ADD_PRINT_TEXT(nowheight +20, 60, "100%", 20, "折让       @(needmoney - (entity.Price - removemoney))元");
        LODOP.ADD_PRINT_TEXT(nowheight+40, 60, "100%", 20, "应付       @(entity.Price - removemoney) 元");
        //LODOP.ADD_PRINT_LINE(nowheight+45, 0, nowheight+35, 500, 2, 1)//横线
        //支付方式
        //        for (var i = 0; i < strlist.length; i++) {
        //            LODOP.ADD_PRINT_TEXT(nowheight + (16 * i)+45, 5, 580, 20, strlist[i].toString());
        //        }
        //如果存在欠款
        if(@entity.QianPrice!="0")
        {
            LODOP.ADD_PRINT_TEXT(nowheight  +60, 60, "100%", 20, "欠款       @entity.QianPrice 元");
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight +  80, 60, "100%", form2height, document.getElementById("form2").innerHTML);
            //var trheight1 = 0;
            //$("#form2 tr").each(function(i) {
            //    trheight1 += $(this).height();
            //    if ($(this).text().length > 13) {
            //        trheight += $(this).height();
            //    }
            //});
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+100, 60, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+120, 60, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+120+(20*i), 60, "100%", 20,arr[i]);
                }
            }
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+120+(arr.length*20), 60, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+140+(arr.length*20), 60, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+180+(arr.length*20), 60, "100%", 20, "签名：");

        }else{
            //不存在欠款
            var form2height = $("#form2").height();
            LODOP.ADD_PRINT_HTM(nowheight + 60, 60, "100%", form2height, document.getElementById("form2").innerHTML);
            var trheight1 = 0;
            //$("#form2 tr").each(function (i) {
            //    trheight1 += $(this).height();
            //})
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+80, 60, "100%", 20, "操作员：@uname");
            for(var i=0; i<arr.length;i++)
            {
                if(i==0)
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+100, 60, "100%", 20, "服务者："+arr[i]);
                }
                else
                {
                    LODOP.ADD_PRINT_TEXT(nowheight + form2height+100+(20*i), 60, "100%", 20,arr[i]);
                }
            }
            //  LODOP.ADD_PRINT_LINE(nowheight + trheight1+75+32+(arr.length*20), 0, nowheight + trheight1+75+32+(arr.length*20), 500, 2, 1)//横线
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+100+(arr.length*20), 60, "100%", 20, "订单时间：" + time);
            LODOP.ADD_PRINT_TEXT(nowheight + form2height+120+(arr.length*20), 60, "100%", 20, "@PrintXuanNameEntity.AttributeValue");
            LODOP.ADD_PRINT_TEXT(nowheight +  form2height+160+(arr.length*20), 60, "100%", 20, "签名：");
        }
    };

    $("#gridtdbody tr").click(function () {
        var projectname = $(this).attr("code");
        $("#labname").text(projectname);
        var Quantity = $(this).attr("Quantity");

        var orderinfoid = $(this).attr("orderinfoid");

        if (orderinfoid == undefined) { return; }
        $.ajax({
            type: "post", //使用get方法访问后台
            dataType: "text", //返回json格式的数据
            url: getControllerUrl("CashManage", "GetAllJoinUser"),
            data: { "orderinfoid": orderinfoid, "projectname": projectname, "Quantity": Quantity },
            success: function (data) {
                $("#gridtdbody1").empty();
                if (data != null) {

                    $("#gridtdbody1").append(data);
                }
            },
            error: function () {
                alert("对不起！系统出错啦，我们会尽快跟踪处理的！");
            }
        });
    })
    //删除参与用户
    function DeleteJoinUser(ID) {
        if (confirm("确认要删除该参与员工吗？")) {
            $.ajax({
                type: "post", //使用get方法访问后台
                dataType: "text", //返回json格式的数据
                url: getControllerUrl("CashManage", "DeleteJoinUser"),
                data: { "ID": ID },
                success: function (data) {
                    if (data != null) {
                        $("#gridtdbody1").find("tr[code='" + ID + "']").remove();
                    }
                },
                error: function () {
                    alert("对不起！系统出错啦，我们会尽快跟踪处理的！");
                }
            });
        }
    }
    //修改参与用户
    function UpdateJoinUser(ID, projectname, Quantity) {
        art.dialog.open("/CashManage/UpdateYeji?ID=" + ID + "&projectname=" + projectname + "&Quantity=" + Quantity, { title: "编辑员工业绩", width: 690, height: 400 })
    }
    //取消订单
    function ClearOrder(ord)
    {
        if(ord!=undefined)//有订单编号才进入
        {
            if(confirm("你确定取消订单吗???")){
                $.ajax({
                    type: "post", //使用get方法访问后台
                    dataType: "text", //返回json格式的数据
                    url: getControllerUrl("CashManage", "ClearOrder"),
                    data: { "OrderNo": ord},
                    success: function (data) {
                        if(data>0)
                        {
                            alert("操作成功!订单已取消.");
                                  window.parent.location.reload();
                                 art.dialog.close();
                                // window.parent.location.reload();
                                // art.dialog.close();
                        }else if(data==-1)
                        {
                            alert("当前订单已取消,请勿多次操作!");
                        }else if(data==-2){
                            alert("订单操作失败!");
                        }else
                        {
                            alert("系统打了个盹,请联系管理员^_^!");
                        }



                    },
                    error: function () {
                        alert("对不起！系统出错啦，我们会尽快跟踪处理的！");
                    }

                });
            }
        }else{
            alert("操作失败,请检查订单编号是否存在!");
        }

    }
    //更改订单
    function UpdateOrder(ord,statu)
    {
        debugger
        if(ord!=undefined)//有订单编号才进入
        {
            if (confirm("你确定操作吗???")) {

                $.ajax({
                    type: "post", //使用get方法访问后台
                    dataType: "text", //返回json格式的数据
                    url: getControllerUrl("CashManage", "UpdateOrderSattu"),
                    data: { "OrderNo": ord,"Statu":statu},
                    success: function (data) {
                        if(data>0)
                        {
                            alert("操作成功!");
                            window.parent.location.reload();
                                 art.dialog.close();

                        }else {
                            alert("操作失败!");
                            art.dialog.close();
                        }
                    },
                    error: function () {
                        alert("对不起！系统出错啦，我们会尽快跟踪处理的！");
                    }

                });
            }
        }else{
            alert("操作失败,请检查订单编号是否存在!");
        }

    }
</script>
</EYB.ServiceEntity.CashEntity.OrderEntity>